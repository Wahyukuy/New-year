<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deep Sea Tasks</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&family=Pacifico&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <style>
        /* Tambahan khusus tema Laut Dalam */
        body { background: linear-gradient(180deg, #001219 0%, #000000 100%); }
        .deadline-input {
            padding: 10px;
            border-radius: 10px;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            margin-bottom: 10px;
        }
        .task-item {
            background: rgba(10, 147, 150, 0.2);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 10px;
            border-left: 5px solid #ee9b00; /* Warna koral untuk penanda */
        }
    </style>
</head>
<body>
    <div class="ocean" id="ocean"></div>
    
    <header>
        <div class="logo">Deep Sea Tasks</div>
        <a href="index.html" class="menu-btn" style="text-decoration: none;">ğŸ  Kembali ke Jadwal</a>
    </header>

    <div class="container">
        <div class="card">
            <h1>ğŸ“Œ Daftar Tugas & Deadline</h1>
            <div style="display: flex; flex-direction: column; gap: 10px; margin-bottom: 20px;">
                <input type="text" id="taskInput" placeholder="Nama Tugas..." class="deadline-input">
                <input type="date" id="dateInput" class="deadline-input">
                <button onclick="addNewTask()" class="menu-btn">Tambah Tugas Baru</button>
            </div>
            
            <div id="taskListContainer">
                </div>
            <div id="motivationModal" class="modal-motivation">
                
                <div id="sadModal" class="modal-sad">
    <h2 style="color: #ff4d4d;">Yah, Deadlinenya Lewat... ğŸŒŠ</h2>
    <p id="sadMessage" style="color: #e9d8a6;">"Tugasmu tenggelam di dasar laut karena tidak selesai tepat waktu."</p>
    <button onclick="closeSadModal()" class="menu-btn" style="background: #ae2012; margin-top: 20px;">Akan Lebih Rajin Lagi!</button>
</div>
                
    <h2>Mantap!!!</h2>
    <p id="motivationQuote">"Satu langkah lebih dekat ke puncak!"</p>
    <button onclick="closeModal()" class="menu-btn" style="margin-top: 20px;">Siap, Lanjut!</button>
</div>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        // Logika khusus halaman tugas
        function addNewTask() {
            const taskName = document.getElementById('taskInput').value;
            const deadline = document.getElementById('dateInput').value;
            
            if (taskName === '' || deadline === '') {
                alert("Isi nama tugas dan tanggalnya ya!");
                return;
            }

// Meminta izin notifikasi saat halaman dibuka
window.addEventListener('load', () => {
    if (Notification.permission !== 'granted') {
        Notification.requestPermission();
    }
    checkDeadlines(); // Jalankan pengecekan saat mulai
});
            
            const taskObj = {
                id: Date.now(),
                name: taskName,
                date: deadline
            };

            displayTask(taskObj);
            saveTaskToLocal(taskObj);
            
            document.getElementById('taskInput').value = '';
            document.getElementById('dateInput').value = '';
        }

        function displayTask(task) {
            const container = document.getElementById('taskListContainer');
            const div = document.createElement('div');
            div.className = 'task-item';
            div.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <strong style="font-size: 1.1em; color: #0a9396;">${task.name}</strong><br>
                        <small style="color: #e9d8a6;">ğŸ“… Deadline: ${task.date}</small>
                    </div>
                    <button onclick="deleteTask(${task.id}, this)" style="background: #ae2012; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer;">Selesai</button>
                </div>
            `;
            container.appendChild(div);
        }

        function saveTaskToLocal(task) {
            let tasks = JSON.parse(localStorage.getItem('deepSeaTasks')) || [];
            tasks.push(task);
            localStorage.setItem('deepSeaTasks', JSON.stringify(tasks));
        }

        const quotes = [
    "Satu tugas selesai, beban berkurang. Kamu hebat!",
    "Jangan berhenti saat lelah, berhentilah saat selesai. Mantap!",
    "Lautan yang tenang tidak menghasilkan pelaut yang tangguh. Terus berjuang!",
    "Harta karun kesuksesan hanya untuk mereka yang tekun. Kerja bagus!",
    "Setiap tugas selesai adalah satu gelembung kebahagiaan baru!"
];

function deleteTask(id, btn) {
    // 1. Hapus tugas dari tampilan dan storage
    btn.closest('.task-item').remove();
    let tasks = JSON.parse(localStorage.getItem('deepSeaTasks'));
    tasks = tasks.filter(t => t.id !== id);
    localStorage.setItem('deepSeaTasks', JSON.stringify(tasks));

    // 2. Munculkan Pop-up Motivasi
    showMotivation();
}

function showMotivation() {
    const modal = document.getElementById('motivationModal');
    const quoteText = document.getElementById('motivationQuote');
    
    // Ambil kutipan acak
    const randomQuote = quotes[Math.floor(Math.random() * quotes.length)];
    quoteText.innerText = `"${randomQuote}"`;
    
    modal.style.display = 'block';
}

function closeModal() {
    document.getElementById('motivationModal').style.display = 'none';
}

function checkDeadlines() {
    const tasks = JSON.parse(localStorage.getItem('deepSeaTasks')) || [];
    const today = new Date();
    today.setHours(0, 0, 0, 0);

    tasks.forEach(task => {
        const deadlineDate = new Date(task.date);
        deadlineDate.setHours(0, 0, 0, 0);

        // Hitung selisih hari
        const diffTime = deadlineDate - today;
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

        if (diffDays === 1) {
            sendNotification("ğŸ“¢ Pengingat Deadline!", `Tugas "${task.name}" harus dikumpul BESOK!`);
        } else if (diffDays === 0) {
            sendNotification("âš ï¸ DEADLINE HARI INI!", `Tugas "${task.name}" harus dikumpul SEKARANG!`);
        }
    });
}

function sendNotification(title, message) {
    if (Notification.permission === 'granted') {
        new Notification(title, {
            body: message,
            icon: 'https://cdn-icons-png.flaticon.com/512/1041/1041916.png' // Icon ombak/tugas
        });
    }
}

        // Cek setiap 1 jam (3600000 milidetik)
setInterval(checkDeadlines, 1800000);
        
        // Muat data saat halaman dibuka
        window.onload = function() {
            createBubbles(); // Tetap panggil gelembung dari script.js
            const saved = JSON.parse(localStorage.getItem('deepSeaTasks')) || [];
            saved.forEach(t => displayTask(t));
        }
        function checkExpiredTasks() {
    let tasks = JSON.parse(localStorage.getItem('deepSeaTasks')) || [];
    const today = new Date();
    today.setHours(0, 0, 0, 0); // Reset waktu ke jam 00:00 agar adil

    let adaYangLewat = false;
    let namaTugasLewat = [];

    // Filter tugas: ambil yang belum lewat, buang yang sudah lewat
    const tasksTetapAda = tasks.filter(task => {
        const deadlineDate = new Date(task.date);
        deadlineDate.setHours(0, 0, 0, 0);

        if (deadlineDate < today) {
            adaYangLewat = true;
            namaTugasLewat.push(task.name);
            return false; // Hapus dari array
        }
        return true; // Tetap simpan
    });

    if (adaYangLewat) {
        // Simpan daftar tugas baru yang sudah bersih dari tugas expired
        localStorage.setItem('deepSeaTasks', JSON.stringify(tasksTetapAda));
        
        // Tampilkan pop-up sedih
        showSadModal(namaTugasLewat);
        
        // Refresh tampilan list tugas di layar
        renderAllTasks(); 
    }
}

function showSadModal(listNama) {
    const modal = document.getElementById('sadModal');
    const msg = document.getElementById('sadMessage');
    msg.innerHTML = `Tugas: <b>${listNama.join(", ")}</b> sudah hangus dan tenggelam karena melewati deadline. Jangan diulangi ya!`;
    modal.style.display = 'block';
}

function closeSadModal() {
    document.getElementById('sadModal').style.display = 'none';
    location.reload(); // Refresh halaman agar list tugas terupdate
}

// Tambahkan fungsi ini untuk merender ulang list (opsional tapi bagus)
function renderAllTasks() {
    const container = document.getElementById('taskListContainer');
    container.innerHTML = ''; // Kosongkan dulu
    const tasks = JSON.parse(localStorage.getItem('deepSeaTasks')) || [];
    tasks.forEach(t => displayTask(t));
}

// Pastikan checkExpiredTasks dipanggil saat web dibuka
window.addEventListener('load', () => {
    checkExpiredTasks();
});
    </script>
</body>
</html>
